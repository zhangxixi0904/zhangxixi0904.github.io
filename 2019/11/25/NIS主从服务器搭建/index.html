<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>NIS主从服务器搭建 | 黑黑的Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="NIS主服务器搭建 安装nis、rpcbind服务， sudo apt-get install nis rpcbind 安装NIS服务后会自动弹出一个窗口要写填写ypdomainname；之后也可以修改，通过下面一条指令，重新弹出窗口设置： sudo dpkg-reconfigure nis  ypdomainname和hostname不是一回事 ypmomainname需要在整个集群中保持一致，">
<meta property="og:type" content="article">
<meta property="og:title" content="NIS主从服务器搭建">
<meta property="og:url" content="http://example.com/2019/11/25/NIS%E4%B8%BB%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/index.html">
<meta property="og:site_name" content="黑黑的Blog">
<meta property="og:description" content="NIS主服务器搭建 安装nis、rpcbind服务， sudo apt-get install nis rpcbind 安装NIS服务后会自动弹出一个窗口要写填写ypdomainname；之后也可以修改，通过下面一条指令，重新弹出窗口设置： sudo dpkg-reconfigure nis  ypdomainname和hostname不是一回事 ypmomainname需要在整个集群中保持一致，">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-11-25T01:33:21.000Z">
<meta property="article:modified_time" content="2019-12-14T02:18:50.000Z">
<meta property="article:author" content="Faith">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="运维">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="黑黑的Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">黑黑的Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-NIS主从服务器搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/25/NIS%E4%B8%BB%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/" class="article-date">
  <time datetime="2019-11-25T01:33:21.000Z" itemprop="datePublished">2019-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Markdown/">Markdown</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      NIS主从服务器搭建
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="NIS主服务器搭建"><a href="#NIS主服务器搭建" class="headerlink" title="NIS主服务器搭建"></a>NIS主服务器搭建</h1><ol>
<li><p>安装nis、rpcbind服务，</p>
<pre><code class="bash">sudo apt-get install nis rpcbind</code></pre>
<p>安装NIS服务后会自动弹出一个窗口要写填写ypdomainname；之后也可以修改，通过下面一条指令，重新弹出窗口设置：</p>
<pre><code>sudo dpkg-reconfigure nis</code></pre>
<blockquote>
<p>ypdomainname和hostname不是一回事</p>
<p>ypmomainname需要在整个集群中保持一致，在本例中是设置成mgt</p>
</blockquote>
</li>
</ol>
<a id="more"></a>



<ol start="2">
<li>修改/etc/default/nis两行内容NISSERVER，NISCLIENT</li>
</ol>
<pre><code class="bash"># line 6: change (set NIS master server)
NISSERVER=master

# line 9: Are we a NIS client?
NISCLIENT=true</code></pre>
<p>如果有从服务器，主服务器也需要开始client模式，所以NISCLIENT也要设置成true</p>
<blockquote>
<p>留一个疑问：如果没有从服务器，还需要设置成true吗？</p>
</blockquote>
<ol start="3">
<li><p>如有必要，修改/etc/ypserv.securenets，设置允许访问的IP</p>
</li>
<li><p>修改/var/yp/Makefile</p>
</li>
</ol>
<pre><code class="bash"># line 23: change
NOPUSH=false

# line 52: change
MERGE_PASSWD=true

# line 56: change
MERGE_GROUP=true</code></pre>
<p>如果有从服务器，nopush行一定要设置成false，不然不会同步到从服务器</p>
<ol start="5">
<li><p>修改 /etc/hosts，将集群中的服务端和客户端的域名和IP都写进去</p>
</li>
<li><p><strong>重要！！！！</strong>如果是主从模式，要将主服务器也设置成客户端模式，配置NIS client的步骤也要在主服务器上进行一遍。</p>
</li>
</ol>
<ul>
<li>修改/etc/yp.conf，把主从的信息都写上</li>
</ul>
<pre><code>domain mgt server mgt.test
domain mgt server mgt-slave.test</code></pre>
<ul>
<li>修改 /etc/nsswitch.conf</li>
</ul>
<pre><code>passwd:     compat nis     # line 7; add
group:     compat nis     # add
shadow:     compat nis     # add
hosts:     files dns nis     # add</code></pre>
<ul>
<li>添加一行信息到/etc/pam.d/common-session</li>
</ul>
<pre><code># add to the end
session optional        pam_mkhomedir.so skel=/etc/skel umask=077</code></pre>
<ol start="7">
<li><p>初始化主服务器</p>
<pre><code class="bash">sudo systemctl restart rpcbind nis 
sudo /usr/lib/yp/ypinit -m </code></pre>
<p>会弹出一些列信息，需要添加上从服务器的hostname</p>
<pre><code class="bash">At this point, we have to construct a list of the hosts which will run NIS
servers.  dlp.srv.world is in the list of NIS server hosts.  Please continue to add
the names for the other hosts, one per line.  When you are done with the
list, type a &lt;control D&gt;.
        next host to add:  mgt.test
        # specify NIS slave
        next host to add: mgt-slave.test
        next host to add:     # Ctrl + D key
The current list of NIS servers looks like this:

mgt.test
mgt-slave.test

Is this correct? [y/n: y] y
We need a few minutes to build the databases...
Building /var/yp/mgt/ypservers...
...
...
Now you can run ypinit -s mgt.test on all slave server.</code></pre>
<blockquote>
<p>不知道是不是从服务器初始化一次后这里又要运行一次，还是上面一开始就把从服务器写上的话就不需要再重新运行，重新运行可能只是中途插入一个从服务器才需要</p>
</blockquote>
<p>至此，主服务器就设置完毕</p>
</li>
</ol>
<h1 id="NIS从服务器搭建"><a href="#NIS从服务器搭建" class="headerlink" title="NIS从服务器搭建"></a>NIS从服务器搭建</h1><ol>
<li><p>安装rpcbind，nis，配置ypdomainname</p>
</li>
<li><p>将从服务器配置成主服务器的客户端模式（下面三步完全依照第一章&lt;NIS主服务器搭建&gt;的内容填写即可）</p>
<ul>
<li><p>修改/etc/yp.conf，把主从的信息都写入</p>
</li>
<li><p>修改 /etc/nsswitch.conf</p>
</li>
<li><p>修改/etc/pam.d/common-session</p>
</li>
</ul>
</li>
<li><p>将主服务器也配置成从服务器的客户端模式（在第一章&lt;NIS主服务器搭建&gt;中已完成）</p>
</li>
<li><p>修改/etc/default/nis</p>
<pre><code># line 6: change (set NIS master server)
NISSERVER=slave

# line 9: Are we a NIS client?
NISCLIENT=true</code></pre>
</li>
<li><p>如有必要，修改 <strong>/etc/ypserv.securenets</strong> </p>
</li>
<li><p>修改 /var/yp/Makefile</p>
<pre><code># line 52: change
MERGE_PASSWD=true

# line 56: change
MERGE_GROUP=true</code></pre>
<blockquote>
<p>从服务器的NOPUSH不需要设置</p>
</blockquote>
</li>
<li><p>设置/etc/hosts，跟主服务器的保持一致即可</p>
</li>
<li><p>初始化从服务器</p>
<pre><code class="bash">sudo systemctl restart rpcbind nis
sudo /usr/lib/yp/ypinit -s mgt.test

# 弹出下列信息即表示成功
We will need a few minutes to copy the data from mgt.test.
Transferring group.bygid...
Trying ypxfrd ... success
...
...
At this point, make sure that /etc/passwd and /etc/group have
been edited so that when the NIS is activated, the data bases you
have just created will be used, instead of the /etc ASCII files.</code></pre>
<p>至此，从服务器配置完毕</p>
</li>
</ol>
<h1 id="NIS客户端搭建"><a href="#NIS客户端搭建" class="headerlink" title="NIS客户端搭建"></a>NIS客户端搭建</h1><ol>
<li><p>安装rpcbind，nis，配置ypdomainname</p>
</li>
<li><p>修改/etc/yp.conf，主从都要写，按第一章的内容填写即可</p>
</li>
<li><p>修改/etc/nsswitch.conf，第一章内容填写即可</p>
</li>
<li><p>修改/etc/pam.d/common-session，按第一章内容填写即可</p>
</li>
<li><p>重启rpcbind和nis服务</p>
<pre><code class="bash">sudo systemctl restart rpcbind nis</code></pre>
<blockquote>
<p>NIS客户端是不需要修改/etc/default/nis和/var/yp/Makefile，也不需要运行ypinit</p>
</blockquote>
</li>
</ol>
<p>​        至此，NIS客户端配置完成</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/25/NIS%E4%B8%BB%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/" data-id="cki92n8ww0007s2wq2im44dzs" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag">运维</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/26/%E7%95%A5%E8%AF%B4PyTorch%E7%9A%84autograd/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          略说PyTorch的autograd
        
      </div>
    </a>
  
  
    <a href="/2019/11/24/Git%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Git学习笔记</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/">程序设计</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pytorch/" rel="tag">pytorch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/trick/" rel="tag">trick</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD/" rel="tag">反向传播</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%B4%A0%E5%85%BB/" rel="tag">程序员素养</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag">运维</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/pytorch/" style="font-size: 10px;">pytorch</a> <a href="/tags/trick/" style="font-size: 20px;">trick</a> <a href="/tags/%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD/" style="font-size: 10px;">反向传播</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%B4%A0%E5%85%BB/" style="font-size: 10px;">程序员素养</a> <a href="/tags/%E8%BF%90%E7%BB%B4/" style="font-size: 10px;">运维</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/07/03/Linux%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/04/14/%E7%88%AC%E8%99%AB%E6%A1%86%E6%9E%B6Scrapy%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/11/29/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%82%BC%E4%B8%B9%E6%9C%AF/">深度学习炼丹术</a>
          </li>
        
          <li>
            <a href="/2019/11/27/%E6%8D%9F%E5%A4%B1%E6%9B%B2%E7%BA%BF%E8%83%BD%E5%91%8A%E8%AF%89%E6%88%91%E4%BB%AC%E4%BB%80%E4%B9%88/">损失曲线能告诉我们什么</a>
          </li>
        
          <li>
            <a href="/2019/11/26/%E7%95%A5%E8%AF%B4PyTorch%E7%9A%84autograd/">略说PyTorch的autograd</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Faith<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>